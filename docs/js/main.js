!function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=" ",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);let o=function(e){return`https://garevna-rest-api.glitch.me/user/${e}`};const s=document.getElementById("preloader"),a=document.getElementById("login-page"),i=document.getElementById("login-container"),l=document.getElementById("account-container");let r;function c(e){history.replaceState(null,null," "),r=e,g(l,i),e.avatar&&(document.getElementById("user-avatar").src=r.avatar),document.getElementById("user-name").innerHTML=`Hello ${r.login}`,document.getElementById("date").innerText=(new Date).toLocaleString("en-US",{dateStyle:"medium"}),function(e,t){new MutationObserver((function(t){t.forEach((function(t){for(let t of document.getElementsByClassName("task-close"))t.onclick=function(t){let n=e.tasks.findIndex(e=>e.id===t.target.parentElement.getAttribute("id"));e.tasks.splice(n,1),t.target.parentNode.remove(),u()};for(let t of document.getElementsByClassName("checkmark"))t.onclick=function(t){let n=t.target.parentElement.parentElement;e.tasks.find(e=>e.id===n.getAttribute("id")).status=f(t.target)}}))})).observe(t,{childList:!0})}(r,document.getElementById("tasks"));for(let e of r.tasks)d(e.task,e.status,e.id);y("new"),u(),function(e){document.cookie=`login=${e.login}`,document.cookie=`psw=${e.password}`,document.cookie="signed-out=; expires="+h}(e),s.style.display="none"}function u(){let e=document.getElementsByClassName("new").length;document.getElementById("new-tasks-num").innerText=0==e?"no tasks":1==e?e+" task":e+" tasks"}function d(e,t,n){let o=`<label class="task__mark">\n                                    <input type="checkbox" >\n                                    <span class="checkmark"></span>\n                            </label>\n                            <p class="task__text">${e}</p>\n                            <img src="../assets/img/close.svg" alt="remove task" class="task-close">`,s=document.getElementById("tasks").insertAdjacentElement("afterbegin",document.createElement("li"));return s.classList.add("task",t),s.setAttribute("id",n),s.innerHTML=o,s}function m(){const e=document.getElementById("tasks");for(;e.firstChild;)e.removeChild(e.firstChild)}function g(e,t){e.style.display="grid",t.style.display="none",e==i?(m(),a.classList.add("login")):a.classList.remove("login")}function f(e){let t,n=e.parentElement.parentElement;return n.classList.contains("new")?(n.classList.remove("new"),n.classList.add("done"),t="done"):n.classList.contains("done")&&(n.classList.remove("done"),n.classList.add("new"),t="new"),u(),t}function y(e){for(let t of document.getElementsByClassName("task"))t.style.display="none",t.classList.contains(e)&&(t.style.display="flex")}document.getElementById("add-task").onclick=function(e){let t=document.getElementById("new-task");if(""===t.value)return B(t,"This field should not be empty."),!1;{let e=function e(){let t=Math.floor(1e4*Math.random());for(let n of document.getElementsByClassName("task")){if(n.getAttribute("id")!==t.toString())return t.toString();e()}}(),n=d(t.value,"new",e);if(r){r.tasks.push({id:n.getAttribute("id"),task:t.value,status:"new"})}document.getElementById("new-task").value="",document.getElementById("new-task").placeholder="What is your task for today? ",u(),""!==B&&B(t," ")}},document.getElementById("all-tasks").onclick=function(e){y("task")},document.getElementById("to-do-tasks").onclick=function(e){y("new")},document.getElementById("done-tasks").onclick=function(e){y("done")},document.getElementById("save-tasks").onclick=function(e){var t;(o(r.login),t=r.tasks,fetch(o(k("login")),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:t})})).then(t=>e.target.innerText="Your tasks successfully saved")},document.getElementById("close-all-tasks").onclick=function(e){r.tasks=[],m()};let p,h=new Date(0).toUTCString();function k(e){let t;return document.cookie.split("; ").map(e=>e.split("=")).map(n=>n[0]===e?t=n[1]:null),t}function E(){document.cookie="login=; expires="+h,document.cookie="psw=; expires="+h,document.cookie="signed out=; expires="+h,g(i,l)}function v(e){return fetch(e).then(e=>e.json())}function B(e,t){return e.nextElementSibling.innerText=t}function w(e){e.files[0]&&(e.files[0].size/1024>300?B(e,"Big size of image. Please upload max 300kB"):"image"!=e.files[0].type.split("/")[0]?B(e,"Not an image. Please upload only images"):function(e){B(e,""),document.getElementById("user-photo").src=URL.createObjectURL(e.files[0])}(e))}function I(e){""===e.value?B(e,"This field is required."):e.value.length<8?B(e,"Password should contain as minimum 8 characters"):e.value.match(/[a-z]+/)?e.value.match(/[A-Z]+/)?e.value.match(/\d+/)?B(e,""):B(e,"Password should contain as minimum 1 digit"):B(e,"Password should contain as minimum 1 latin letter in upper register"):B(e,"Password should contain as minimum 1 latin letter in low register")}document.getElementById("avatar").onchange=function(e){w(e.target);let t=new FileReader;t.readAsDataURL(e.target.files[0]),t.onload=function(e){p=e.target.result}},document.getElementById("login").onchange=function(e){e.target.value?v(o(e.target.value)).then(t=>{t.error?B(e.target,""):B(e.target,"Sorry, but this login is already occupied by another user. ")}):B(e.target,"This field is required")},document.getElementById("password").oninput=function(e){I(e.target)},document.getElementById("registration-btn").onclick=function(e){const t={};let n=document.getElementById("avatar"),s=document.getElementById("login"),a=document.getElementById("password"),i=[];if(0!=function(e){const t=e.getElementsByTagName("input");for(let e of t)if("login"==e.id?""===e.value&&B(e,"This field is required."):"avatar"==e.id?w(e):"password"==e.id&&I(e),0!=e.nextElementSibling.textContent.length)var n=!1;return n}(document.getElementById("registration-form"))){n.files[0]?t[n.name]=p:t[n.name]=!1,t[s.name]=s.value;let e=Sha256.hash(a.value);t[a.name]=e,t.tasks=i,l=o(s.value),r=t,fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(e=>e.json()).then(e=>c(e))}var l,r};let b=document.getElementById("sign-in-form").getElementsByTagName("input");document.getElementById("sign-in-btn").onclick=function(e){let t=document.getElementById("user-login"),n=document.getElementById("user-password");for(let e of b)""==e.value&&B(e,"This field is required");t.value&&v(o(t.value)).then(e=>{e.login===t.value?e.password===Sha256.hash(n.value)?c(e):B(document.getElementById("user-password"),"Password is wrong. Try again"):B(t,"Sorry, we can not find user with such login")})};for(let e of document.getElementsByClassName("eye"))e.onclick=function(e){let t=e.target.nextElementSibling;"password"===t.type?t.type="text":t.type="password"};document.getElementById("sign-out").onclick=function(e){g(i,l),document.cookie="signed-out=true"},document.getElementById("delete-account").onclick=function(e){var t;t=o(k("login")),fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(e=>e),E();for(let e of b)e.value=" ";g(i,l)};let x=v(o(k("login")));k("login")?k("signed-out")?(document.getElementById("user-login").value=k("login"),s.style.display="none"):x.then(e=>e.error?E():e.password===k("psw")?c(e):console.log("psw different in db and cookie")):s.style.display="none",function(){let e=document.getElementsByClassName("quote");e[Math.floor(Math.random()*e.length)].style.display="flex"}();n(0)}]);